<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Libreria</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">

    <style>
        .card {
            height: 100%;
        }

        .card img {
            height: 300px;
        }
    </style>
</head>

<body>
    <div class="container mt-5">
        <h1 class="text-center mb-4">Libreria</h1>
        <div class="row" id="booksRow"></div>
        <div class="row mt-5">
            <div class="col">
                <h3>Carrello</h3>
                <ul id="cart" class="list-group"></ul>
            </div>
        </div>
    </div>
    
    <script>
        async function fetchBooks() {
            try {
                const response = await fetch('https://striveschool-api.herokuapp.com/books');
                const data = await response.json();
                const booksRow = document.getElementById('booksRow');
    
                data.forEach(book => {
                    const card = document.createElement('div');
                    card.classList.add('col-md-3', 'mb-4');
    
                    card.innerHTML = `
                        <div class="card">
                            <img src="${book.img}" class="card-img-top" alt="${book.title}">
                            <div class="card-body">
                                <h5 class="card-title">${book.title}</h5>
                                <p class="card-text">Prezzo: ${book.price} €</p>
                                <button onclick="addToCart('${book.title}', ${book.price})" class="btn btn-primary">Compra ora</button>
                                <button onclick="removeCard(this)" class="btn btn-danger">Scarta</button>
                            </div>
                        </div>
                    `;
    
                    booksRow.appendChild(card);
                });
            } catch (error) {
                console.error('Si è verificato un errore:', error);
            }
        }
    
        function addToCart(title, price) {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
    
            cart.push({ title, price });
            localStorage.setItem('cart', JSON.stringify(cart));
    
            updateCartView();
        }
    
        function removeFromCart(index) {
            const cart = JSON.parse(localStorage.getItem('cart'));
    
            cart.splice(index, 1);
            localStorage.setItem('cart', JSON.stringify(cart));
    
            updateCartView();
        }
    
        function updateCartView() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const cartElement = document.getElementById('cart');
    
            cartElement.innerHTML = '';
    
            cart.forEach((item, index) => {
                const li = document.createElement('li');
                li.classList.add('list-group-item');
                li.innerHTML = `${item.title} - Prezzo: ${item.price} € 
                    <button onclick="removeFromCart(${index})" class="btn btn-danger btn-sm">Rimuovi</button>`;
                cartElement.appendChild(li);
            });
        }
    
        function removeCard(button) {
            const card = button.closest('.col-md-3');
            card.remove();
        }
    
        document.addEventListener('DOMContentLoaded', () => {
            fetchBooks();
            updateCartView();
        });
    </script>

    <script src="https://stackpath.bootstrapcdn.com/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>
</body>

</html>
